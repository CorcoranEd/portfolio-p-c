<link rel="import" href="../../bower_components/polymer/polymer.html">
<dom-module id="portfolio-app">
	<template>
		<style include="shared-styles">
		:root {}

		.overlay {
			position: absolute;
			top: 0;
			left: 0;
			bottom: 0;
			right: 0;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			background: var(--background-color);
		}

		.copy {
			text-align: center;
		}
		</style>

		<app-location route="{{route}}"></app-location>

		<app-route route="{{route}}"
							 pattern="/:page"
							 data="{{pageData}}"
							 tail="{{tailData}}"
							 active="{{pageActive}}"></app-route>

		<app-scrollpos-control selected="{{pageData.page}}"></app-scrollpos-control>

		<iron-ajax auto
							 url="/config.json"
							 handle-as="json"
							 last-response="{{config}}"></iron-ajax>

		<!-- <epic-contentful token="[[config.contentful.token]]"
										 space="[[config.contentful.space]]"
										 entries="{{projects}}"
										 content-type="project"
										 mode="entries"></epic-contentful> -->

		<iron-ajax id="contentful"
							 url$="//cdn.contentful.com/spaces/[[config.contentful.space]]/entries?access_token=[[config.contentful.token]]"
							 handle-as="json"
							 last-response="{{projects}}"
							 loading="{{loading}}"></iron-ajax>


		<iron-pages attr-for-selected="id" selected="[[pageData.page]]">

			<site-page class="page-wrapper" config="[[config]]">
				<project-list projects="[[projects]]"></project-list>
			</site-page>

			<template is="dom-repeat" items="[[projects.items]]">
				<site-page id="[[item.fields.slug]]" class="page-wrapper" config="[[config]]">
					<project-detail config="[[config]]" project="[[item]]" projects="[[projects]]"></project-detail>
				</site-page>
			</template>

			<site-page id="about" class="page-wrapper" config="[[config]]">
				<div class="wrapper">
					<marked-element markdown="[[config.site.about]]">
						<div class="markdown-html"></div>
					</marked-element>
				</div>
			</site-page>

			<site-page id="404" class="page-wrapper" config="[[config]]">
				<div class="wrapper copy">
					<marked-element markdown="[[config.site.lost]]">
						<div class="markdown-html"></div>
					</marked-element>
				</div>
			</site-page>

		</iron-pages>

		<div id="overlay" class="overlay" hidden$="[[!loading]]">
			<paper-spinner active="[[loading]]"></paper-spinner>
		</div>

	</template>
	<script>
	Polymer({

		is: 'portfolio-app',

		properties: {
			config: Object,
			projects: Object,
			pageData: Object,
			route: Object,
			loading: {
				type: Boolean,
				value: false,
				notify: true
			}
		},

		observers: [
			'_logData(projects)',
			'_ajaxRequest(config)'
		],

		created: function() {
		  console.log(this.localName + '#' + this.id + ' was created');
		},

		ready: function() {
		  console.log(this.localName + '#' + this.id + ' has local DOM initialized');
		},

		attached: function() {
		  console.log(this.localName + '#' + this.id + ' was attached');
		},

		_logData: function() {
			console.log("API Call â€” projects", this.projects);
		},

		_ajaxRequest: function() {
			this.$.contentful.generateRequest()
		}

	});
	</script>
</dom-module>
